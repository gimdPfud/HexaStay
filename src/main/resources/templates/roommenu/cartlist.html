<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>모바일 주문 페이지</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background-color: #f9f9f9; }

        .container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 10px;
        }

        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            font-size: 20px;
            border-bottom: 2px solid #ddd;
        }

        .food-list { list-style: none; padding: 10px; }
        .food-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            position: relative;
        }
        .food-info { flex-grow: 1; }
        .food-info p { margin: 2px 0; }
        .price { font-weight: bold; }

        .action-btns {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
        }

        .action-btn:hover {
            background-color: #ddd;
        }

        .request-section {
            margin-top: 20px;
            text-align: left;
        }

        .request-section label {
            font-size: 16px;
            margin-bottom: 5px;
            display: block;
        }

        .request-section textarea {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            height: 100px;
            border-radius: 5px;
            border: 1px solid #ddd;
            resize: none;
        }

        /* 할인금액과 최종결제금액 표시 */
        .pricing-section {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }

        .pricing-section div {
            font-size: 16px;
        }

        .pricing-section .discount {
            color: red;
        }

        .pricing-section .final-total {
            font-weight: bold;
        }

        /* 버튼 스타일 */
        .btn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        .add-to-cart-btn {
            background-color: #ffeb3b;
            color: black;
        }

        .add-to-cart-btn:hover {
            background-color: #fdd835;
        }

        .back-btn {
            background-color: #ddd;
            color: black;
        }

        .back-btn:hover {
            background-color: #ccc;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- 헤더: 메뉴 제목 -->
    <div class="header">
        <div>주문</div>
    </div>

    <!-- 메뉴 리스트: 동적으로 메뉴 아이템 출력 -->
    <ul class="food-list">
        <li th:each="roomMenuCartDTO : ${cartDetailDTOList}" class="food-item">
            <div class="food-info">
                <p th:text="${roomMenuCartDTO.roomMenuCartDetailMenuItemName}"></p>
                <span th:data-price="${roomMenuCartDTO.roomMenuCartDetailMenuItemPrice}" th:id="${'price_' + roomMenuCartDTO.roomMenuCartDetailNum}" th:text="${roomMenuCartDTO.roomMenuCartDetailMenuItemPrice}">가격</span>
            </div>
        </li>
    </ul>

    <!-- 요청사항 입력 섹션 -->
    <div class="request-section">
        <label for="request-input">요청사항</label>
        <textarea id="request-input" placeholder="요청사항을 입력하세요..."></textarea>
    </div>

    <!-- 할인금액과 최종결제금액 표시 -->
    <div class="pricing-section">
        <div class="discount">할인금액: 0원</div>
        <div class="final-total">최종결제금액: 0원</div>
    </div>

    <!-- 결제하기 및 목록으로 버튼 -->
    <button class="btn add-to-cart-btn" onclick="processPayment()">결제하기</button>
    <button class="btn back-btn" onclick="goBack()">목록으로</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const email = getLoggedInEmail(); // 로그인한 이메일 가져오기 (아래 설명)

        fetch(`/roommenu/orderpage/cartlist?email=${email}`)
            .then(res => res.json())
            .then(data => {
                console.log(data); // 데이터 구조를 확인
                const list = document.getElementById('food-list');
                list.innerHTML = ''; // 기존 비우기

                data.content.forEach(item => {
                    const li = document.createElement('li');
                    li.classList.add('food-item');
                    li.innerHTML = `
            <div>
                <h4>${item.roomMenuName}</h4>
                <p>수량: ${item.roomMenuCartItemAmount}</p>
                <p>가격: ${item.roomMenuPrice}원</p>
            </div>
        `;
                    list.appendChild(li);
                });

                // TODO: 할인금액/최종금액 계산해서 넣기
            })
            .catch(err => {
                console.error('장바구니 로딩 실패', err);
            });

        function getLoggedInEmail() {
            // 서버에서 principal.getName()으로 이메일 확인하니까
            // 클라이언트에서도 세션 등에서 이메일 가져와야 함
            // 또는 서버에서 Thymeleaf로 email 값을 넘겨주는 방식 추천
            return sessionStorage.getItem('userEmail');  // 예시
        }

        // 수정 버튼 클릭 시
        function editItem(itemId) {
            alert(`아이템 ${itemId}을(를) 수정합니다.`);
            // 여기에서 수정 로직을 구현할 수 있습니다.
        }

        // 삭제 버튼 클릭 시
        function deleteItem(itemId) {
            const itemIndex = menuItems.findIndex(item => item.id === itemId);
            if (itemIndex !== -1) {
                menuItems.splice(itemIndex, 1); // 해당 아이템 삭제
                updateMenuList();  // 메뉴 목록을 갱신합니다.
            }
        }

        // 메뉴 목록 갱신 함수
        function updateMenuList() {
            const foodList = document.getElementById('food-list');
            foodList.innerHTML = '';  // 기존 목록을 지우고
            loadMenuItems();  // 새로운 목록을 다시 불러옵니다
        }


        // 목록으로 돌아가기
        function goBack() {
            window.history.back();
        }

        // 페이지 로딩 시 메뉴 아이템을 불러옵니다
        loadMenuItems();
</script>

</body>
</html>
