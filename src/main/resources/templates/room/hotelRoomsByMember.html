<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>room λ©λ΅</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        .hotel-img {
            height: 180px;
            object-fit: cover;
            border-bottom: 1px solid #dee2e6;
        }

        .card-title {
            font-size: 1.25rem;
        }

        .card-text {
            font-size: 0.95rem;
        }

        .card-horizontal {
            display: flex;
            flex-direction: row;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .card-horizontal img {
            width: 180px;
            object-fit: cover;
        }

        .card-body {
            padding: 1rem;
            flex: 1;
        }

        @media (max-width: 576px) {
            .card-horizontal {
                flex-direction: column;
            }

            .card-horizontal img {
                width: 100%;
                height: 150px;
            }
        }

        .card {
            border-radius: 1rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 576px) {
            .hotel-img {
                height: 140px;
            }
        }

        /* ν•„ν„° μ¤νƒ€μΌ */
        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .filter-bar input {
            flex: 1 1 300px;
        }

        .table img {
            object-fit: cover;
            height: 40px;
            width: 60px;
            border-radius: 0.25rem;
        }
    </style>
</head>

<body>
<div class="container mt-5">
    <input type="hidden" th:value="${roomNum}" id="roomNum">

    <!-- λ©”μ‹μ§€ μ¶λ ¥ -->
    <div th:if="${successMessage}" class="alert alert-success" role="alert" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" role="alert" th:text="${errorMessage}"></div>

    <h2 class="fw-bold mb-4 text-center">νμ›μ΄ μμ•½ν• Room λ°°μ •λ©λ΅</h2>

    <!-- ν•„ν„° μ…λ ¥μ°½ -->
    <div class="filter-bar mb-4">
        <input type="text" class="form-control" id="filterInput" placeholder="λ£Έ μ΄λ¦„, νƒ€μ…, κ°€κ²© κ²€μƒ‰">
    </div>

    <!-- μΉ΄λ“ λ¦¬μ¤νΈ -->
    <div class="list-group">
        <div class="list-group-item d-flex align-items-center mb-3 p-3 shadow-sm rounded"
             th:each="hotelRoom : ${hotelRooms}" style="background-color: #ffffff;">

            <!-- π“· μ΄λ―Έμ§€ (λΉ„μ¤‘ ν¬κ²) -->
            <div class="me-4">
                <img th:src="@{${hotelRoom.hotelRoomProfileMeta}}" alt="μ΄λ―Έμ§€"
                     style="width: 160px; height: 120px; object-fit: cover; border-radius: 10px;">
            </div>

            <!-- π“„ ν…μ¤νΈ μ •λ³΄ (λΉ„μ¤‘ μ‘κ²) -->
            <div class="flex-grow-1 d-flex flex-column justify-content-between" style="min-width: 0;">
                <div class="fw-bold text-primary fs-5 text-truncate" th:text="${hotelRoom.hotelRoomName}">
                    νΈν…” μ΄λ¦„
                </div>
                <div class="text-muted small mt-2">
                    <span class="me-3"><strong>νƒ€μ…:</strong> <span th:text="${hotelRoom.hotelRoomType}">νƒ€μ…</span></span>
                    <span><strong>κ°€κ²©:</strong> <span th:text="${hotelRoom.hotelRoomPrice} + 'μ›'">κ°€κ²©</span></span>
                </div>
            </div>

            <!-- π›  μμ • λ²„νΌ -->
            <div class="ms-4 text-end">
                <button class="btn btn-outline-primary btn-sm open-hotelroom-modal-btn"
                        th:attr="data-room-num=${roomNum}">
                   Rommλ°°μ •λ³€κ²½
                </button>
            </div>
        </div>
    </div>

    <!-- νΈν…” λ£Έ μ„ νƒ λ¨λ‹¬ -->
    <div class="modal fade" id="hotelRoomModal" tabindex="-1" aria-labelledby="hotelRoomModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="hotelRoomModalLabel">νΈν…” λ£Έ μ„ νƒ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="hotelRoomSearchKeyword" class="form-control mb-3" placeholder="νΈν…”λ£Έ μ΄λ¦„μΌλ΅ κ²€μƒ‰">
                    <table class="table">
                        <thead>
                        <tr>
                            <th>μ΄λ―Έμ§€</th>
                            <th>νΈν…”λ£Έ λ²νΈ</th>
                            <th>νΈν…”λ£Έ μ΄λ¦„</th>
                            <th>μ„ νƒ</th>
                        </tr>
                        </thead>
                        <tbody id="hotelRoomSearchResult"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- νμ΄μ§€λ„¤μ΄μ… -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-5">
            <li th:classappend="${currentPage == 0} ? 'disabled'" class="page-item">
                <a class="page-link" th:href="@{/hotelRoomsByMember/{memberNum}(memberNum=${memberNum}, page=${currentPage - 1})}">μ΄μ „</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, hotelRooms.totalPages - 1)}"
                class="page-item"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link"
                   th:href="@{/hotelRoomsByMember/{memberNum}(memberNum=${memberNum}, page=${i})}"
                   th:text="${i + 1}"></a>
            </li>
            <li th:classappend="${hotelRooms.totalPages - 1 == currentPage} ? 'disabled'" class="page-item">
                <a class="page-link" th:href="@{/hotelRoomsByMember/{memberNum}(memberNum=${memberNum}, page=${currentPage + 1})}">λ‹¤μ</a>
            </li>
        </ul>
    </nav>


<script>
    let selectedRoomNum = null;

    // λ¨λ‹¬ μ¤ν”
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('open-hotelroom-modal-btn')) {
            selectedRoomNum = e.target.getAttribute('data-room-num');
            const modal = new bootstrap.Modal(document.getElementById('hotelRoomModal'));
            modal.show();
        }
    });

    // μ‹¤μ‹κ°„ κ²€μƒ‰
    document.getElementById('hotelRoomSearchKeyword').addEventListener('input', function () {
        const keyword = this.value;
        fetch(`/admin/hotelroom/search?keyword=${keyword}`)
            .then(res => res.json())
            .then(data => {
                const resultArea = document.getElementById('hotelRoomSearchResult');
                resultArea.innerHTML = '';
                data.forEach(hotelRoom => {
                    const row = `
                    <tr>
                        <td><img src="${hotelRoom.hotelRoomProfileMeta}" width="60"></td>
                        <td>${hotelRoom.hotelRoomNum}</td>
                        <td>${hotelRoom.hotelRoomName}</td>
                        <td>
                            <button class="btn btn-sm btn-success select-hotelroom-btn" data-hotelroom-num="${hotelRoom.hotelRoomNum}">
                                μ„ νƒ
                            </button>
                        </td>
                    </tr>`;
                    resultArea.insertAdjacentHTML('beforeend', row);
                });
            });
    });

    // νΈν…”λ£Έ μ„ νƒ β†’ DB μ—…λ°μ΄νΈ
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('select-hotelroom-btn')) {
            const newHotelRoomNum = e.target.getAttribute('data-hotelroom-num');

            fetch("/admin/room/update-hotelroom", {
                method: "POST",
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `roomNum=${selectedRoomNum}&hotelRoomNum=${newHotelRoomNum}`
            })
                .then(res => res.text())
                .then(msg => {
                    alert(msg);
                    location.reload();
                })
                .catch(err => alert("μμ • μ‹¤ν¨: " + err));
        }
    });

    // μΉ΄λ“ ν•„ν„°λ§
    document.getElementById('filterInput').addEventListener('input', function () {
        const keyword = this.value.toLowerCase();
        document.querySelectorAll('.hotel-room-card').forEach(card => {
            const name = card.querySelector('.room-name').textContent.toLowerCase();
            const type = card.querySelector('.room-type').textContent.toLowerCase();
            const price = card.querySelector('.room-price').textContent.toLowerCase();
            card.closest('.col').style.display =
                (name.includes(keyword) || type.includes(keyword) || price.includes(keyword)) ? '' : 'none';
        });
    });
</script>

</body>
</html>
