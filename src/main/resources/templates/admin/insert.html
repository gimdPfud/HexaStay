<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout.html}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>직원 정보 입력</title>
</head>
<body class="w-100 vh-100 bg-light">
<div layout:fragment="content">

    <form>
        <div class="container p-4 rounded shadow-sm w-100 h-100" style="max-width: 400px;">

            <div class="d-flex w-100" style="justify-content: center;">
                <img src="https://via.placeholder.com/103x133" class="rounded" style="width: 103px; height: 133px;">
            </div>
            <div class="d-flex w-100 ms-5 mt-3" style="justify-content: center;">
                <input type="file" name="file" id="file">
            </div>

            <div class="mb-2">
                <label class="form-label">사번</label>
                <input type="text" name="adminEmployeeNum" class="form-control">
            </div>
            <div class="mb-2">
                <label class="form-label">이메일 (ID)</label>
                <input type="text" name="adminEmail" class="form-control">
            </div>
            <div class="mb-2">
                <label class="form-label">비밀번호</label>
                <input type="text" name="adminPassword" class="form-control">
            </div>
            <div class="mb-2">
                <label class="form-label">비밀번호 확인</label>
                <input type="text" id="adminPasswordTwo" class="form-control">
            </div>
            <div class="mb-2">
                <label class="form-label">이름</label>
                <input type="text" name="adminName" class="form-control">
            </div>
            <div class="mb-2">
                <label class="form-label">주민등록번호</label>
                <div class="row">
                    <input type="text" id="adminResidentNumPartOne" class="form-control" style="margin-left: 3.5%; width:46%"> -
                    <input type="text" id="adminResidentNumPartTwo" class="form-control" style="width:46%">
                </div>
            </div>
            <input hidden name="adminResidentNum" id="adminResidentNum" value="">

            <div class="mb-2">
                <label class="form-label">주소</label>
                <input type="text" name="adminAddress" class="form-control">
            </div>
            <div class="mb-2 row">
                <label class="form-label">연락처</label>
                <select class="form-select" id="phonePartOne" style="margin-left : 3.5%; width:30%">
                    <option>010</option>
                    <option>011</option>
                    <option>017</option>
                </select> -
                <input type="text" id="phonePartTwo" class="form-control" style="width:30%"> -
                <input type="text" id="phonePartThree" class="form-control" style="width:30%">

                <input hidden name="adminPhone" id="phonePartFour" class="form-control" style="width:30%"
            </div>

            <div class="mb-2">
                <label class="form-label">소속</label>
                <div class="row g-2">
                    <div class="col-3">
                        <select id="adminChoice" class="form-select">
                            <option>본사</option>
                            <option>지사</option>
                            <option>지점</option>
                            <option>스토어</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <select name="adminCenter" id="adminCenter" class="form-select">
                            <option th:each="centerList : ${centerDTOList}" th:text="${centerList.centerName}" th:valuie="${centerList.centerNum}"></option>
                        </select>
                    </div>
                    <div class="col-3">
                        <select name="adminBranch" id="adminBranch" class="form-select" disabled>
                            <option></option>
                        </select>
                    </div>
                    <div class="col-3">
                        <select name="adminFacility" id="adminFacility" class="form-select" disabled>
                            <option></option>
                        </select>
                    </div>
                </div>
            </div>



            <div class="mb-3">
                <label class="form-label">입사일</label>
                <input type="date" class="form-control">
            </div>
            <div class="d-flex justify-content-center gap-3">
                <button type="submit" onclick="submitForm()" class="btn btn-success">등록</button>
                <button class="btn btn-danger">취소</button>
            </div>
        </div>

    </form>

    <script>
        let center = document.getElementById('adminCenter');
        let branch = document.getElementById('adminBranch');
        let facility = document.getElementById('adminFacility');

        // 셀렉트 박스 조작
        document.getElementById('adminChoice').addEventListener('change', function () {
            let choice = this.value;

            // 모든 선택창 초기화
            branch.disabled = true;
            facility.disabled = true;
            branch.value = "";
            facility.value = "";

            if (choice === "본사") {
                center.disabled = false;
            } else if (choice === "지사") {
                center.disabled = false;
                branch.disabled = false;
            } else if (choice === "지점") {
                center.disabled = false;
                branch.disabled = false;
            } else if (choice === "스토어") {
                center.disabled = false;
                branch.disabled = false;
                facility.disabled = false;
            }
        });

        // 가입버튼 관련
        function submitForm() {
            // 주민번호 합체
            document.getElementById('adminResidentNum').value = document.getElementById('adminResidentNumPartOne').value + "-" + document.getElementById('adminResidentNumPartTwo').value;
            // 폰번호 합체
            document.getElementById('adminPhone').value = document.getElementById('phonePartOne').value + "-" + document.getElementById('phonePartTwo').value + "-" + document.getElementById('phonePartThree').value;

            // 다른 벨류 차단
            let choice = document.getElementById('adminChoice').value;

            if (choice === "지사") {
                center.disabled = true;
            } else if (choice === "지점") {
                center.disabled = true;
                branch.disabled = true;
            } else if (choice === "스토어") {
                center.disabled = true;
                branch.disabled = true;
                facility.disabled = true;
            }



        }



        // 소속 조회
        document.getElementById('adminChoice').addEventListener('change', async function () {
            let choice = this.value;
            let branchSelect = document.getElementById('adminBranch');
            let facilitySelect = document.getElementById('adminFacility');

            // 지사 조회
            if (choice === "지사" || choice === "지점" || choice === "스토어") {
                await fetchOptions('/searchbranch', { branchName: choice }, branchSelect);
            }

            // 지점 조회
            if (choice === "지점" || choice === "스토어") {
                await fetchOptions('/searchfacility', { facilityName: choice }, facilitySelect);
            }
        });

        async function fetchOptions(url, params, selectElement) {
            let queryString = new URLSearchParams(params).toString();
            let response = await fetch(`${url}?${queryString}`);
            if (response.ok) {
                let data = await response.json();
                updateSelectOptions(selectElement, data);
            }
        }

        function updateSelectOptions(selectElement, data) {
            selectElement.innerHTML = '<option value="">선택</option>'; // 초기화
            data.forEach(item => {
                let option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
            });
        }

        // 지사 조회


        // 지점 조회


    </script>

</div>
</body>
</html>